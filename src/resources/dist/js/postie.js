void 0===Craft.Postie&&(Craft.Postie={}),$((function(){$(document).on("change",".provider-shipping-methods-all-switch .lightswitch",(function(){var t=$(".provider-shipping-methods").find(".lightswitch");$(this).hasClass("on")?t.each((function(){$(this).data("lightswitch").turnOn()})):t.each((function(){$(this).data("lightswitch").turnOff()}))}))})),Craft.Postie.ProviderRatesTest=Garnish.Base.extend({init(){this.$result=$(".js-postie-rates-test-results"),this.$testBtn=$(".js-postie-rates-test-btn"),this.addListener(this.$testBtn,"click","runTest")},runTest(t){t.preventDefault();var e=$("#main-content").find("select, textarea, input").serialize();this.$testBtn.addClass("vui-loading"),this.$result.html(""),Craft.sendActionRequest("POST","postie/providers/test-rates",{data:e}).then((t=>{if(t.data.errors.length)throw{response:{data:{message:JSON.stringify(t.data.errors)}}};var e=$('<div class="postie-rates-tester-table"></div>'),s=$("<ul></ul").appendTo(e);$.each(t.data.rates,(function(t,e){$('<li><span class="label">'+e.serviceName+"</span> <code>"+e.serviceCode+'</code> <span class="price">$'+e.rate+"</span></li>").appendTo(s)})),this.$result.html(e)})).catch((({response:t})=>{var e="<br><code>"+t.data.message+"</code>";this.$result.html('<span class="error">'+e+"</span>")})).finally((()=>{this.$testBtn.removeClass("vui-loading")}))}}),Craft.Postie.OrderShipments=Garnish.Base.extend({init(t){this.orderId=t.orderId,this.rateId=t.rateId,this.$newBtn=$(".js-postie-new-shipment"),this.addListener(this.$newBtn,"click","openNewModal")},openNewModal(t){new Craft.Postie.OrderShipmentModal({orderId:this.orderId,rateId:this.rateId})}}),Craft.Postie.OrderShipmentModal=Garnish.Modal.extend({init(t){this.orderId=t.orderId,this.rateId=t.rateId,this.$form=$('<form class="modal fitted create-shipment-modal" method="post" accept-charset="UTF-8"/>').appendTo(Garnish.$bod),this.$body=$('<div class="body"></div>').appendTo(this.$form),this.$spinner=$('<div class="spinner spinner-absolute"/>').appendTo(this.$body),this.$footer=$('<div class="footer hidden"/>').appendTo(this.$form),this.$footerSpinner=$('<div class="spinner right hidden"/>').appendTo(this.$footer),this.$buttons=$('<div class="buttons right"/>').appendTo(this.$footer),this.$cancelBtn=$('<input type="button" class="btn" value="'+Craft.t("postie","Cancel")+'" />').appendTo(this.$buttons),this.$createButton=$('<input type="submit" class="btn submit" value="'+Craft.t("postie","Create Shipment")+'" />').appendTo(this.$buttons),this.addListener(this.$cancelBtn,"click","hide"),this.addListener(this.$createButton,"click","onSubmit"),this.base(this.$form,t)},onFadeIn:function(){var t={orderId:this.orderId,rateId:this.rateId};Craft.sendActionRequest("POST","postie/shipments/shipment-modal",{data:t}).then((t=>{this.$body.html(t.data.html),this.$footer.removeClass("hidden"),setTimeout((()=>{this.updateSizeAndPosition()}),100)})).catch((({response:t})=>{t&&t.data&&t.data.message?Craft.cp.displayError(t.data.message):Craft.cp.displayError()})).finally((()=>{this.$spinner.addClass("hidden")})),this.base()},onSubmit:function(t){t.preventDefault(),this.$footerSpinner.removeClass("hidden");const e=this.$form.serialize();Craft.sendActionRequest("POST","postie/shipments/create-shipment",{data:e}).then((t=>{t.success?(Craft.cp.displayNotice(Craft.t("postie","Shipment Created.")),location.reload()):Craft.cp.displayError()})).catch((({response:t})=>{t&&t.data&&t.data.message?Craft.cp.displayError(t.data.message):Craft.cp.displayError()})).finally((()=>{this.$footerSpinner.addClass("hidden")}))}});
//# sourceMappingURL=postie.js.map